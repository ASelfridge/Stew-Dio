<html>
  <head>
    <title>Starting Environment</title>

    <script src="js/aframe-v0.8.2.min.js"></script>
    <script src="js/master.js"></script>
    <script src="js/socket.io.min.js"></script>
    <script src="js/easyrtc.js"></script>
    <script src="js/networked-aframe.min.js"></script>
    <script src="https://rawgit.com/Ctrl-Alt-Zen/aframe-mobile-controls/master/components/twoway-motion/twoway-motion.js"></script>
    <script src="https://rawgit.com/Ctrl-Alt-Zen/aframe-mobile-controls/master/components/tilt-turn/tilt-turn.js"></script>
    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="js/trigger.js"></script>
    <script src="js/object-pickup.js"></script>
    <script src="js/object-place.js"></script>
    <script src="js/new-recipe.js"></script>
    <script src="js/tool-component.js"></script>
    <script src="js/toggle-ownership.component.js"></script>
    <script src="js/parent-constraint.js"></script>
    <script src="js/detect-collision.js"></script>
    <script src="js/onSceneLoad.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
  </head>
  
  <body>
    <a-scene networked-scene="room: StewDio; debug: true; connectOnLoad:false;">
        <!-------------- TEXTURES ---------------->
        <a-assets>
            <img id="skymap" src="assets/textures/sunsetGradient.png" />
            <img crossorigin="anonymous" id="speechBubble1_map" src="assets/textures/speechBubble1_map.png">
            <img crossorigin="anonymous" id="speechBubble2_map" src="assets/textures/speechBubble2_map.png">
        </a-assets>

        <!-------------- SOUNDS ---------------->
        <a-assets>
            <a-asset-item crossorigin="anonymous" id="ambianceSrc" src="assets/sounds/stewIt_ambience.mp3" response-type="arraybuffer"></a-asset-item>
            <a-asset-item crossorigin="anonymous" id="musicSrc" src="assets/sounds/Whimsical-Popsicle.mp3" response-type="arraybuffer"></a-asset-item>
            <a-asset-item crossorigin="anonymous" id="customerBellSrc" src="assets/sounds/customer-bell.mp3" response-type="arraybuffer"></a-asset-item>
            <a-asset-item crossorigin="anonymous" id="customerGreetingSrc" src="assets/sounds/customer-hello.wav" response-type="arraybuffer"></a-asset-item>
        </a-assets>
      
        <!---------------- MODELS ---------------->
        <a-assets>
            <a-asset-item id="carrot_model" src="assets/models/carrot.obj"></a-asset-item>
            <a-asset-item id="table_model" src="assets/models/table.obj"></a-asset-item>
            <a-asset-item id="knife_model" src="assets/models/knife.obj"></a-asset-item>
            <a-asset-item id="cuttingBoard_model" src="assets/models/cuttingBoard.obj"></a-asset-item>
            <a-asset-item id="customerService_model" src="assets/models/customerService.obj"></a-asset-item>
            <a-asset-item id="ingredientStation_model" src="assets/models/ingredientStation.obj"></a-asset-item>
            <a-asset-item id="ladle_model" src="assets/models/ladle.obj"></a-asset-item>
            <a-asset-item id="pot_model" src="assets/models/pot.obj"></a-asset-item>
            <a-asset-item id="recipeBook_model" src="assets/models/recipeBook.obj"></a-asset-item>
            <a-asset-item id="stove_model" src="assets/models/stove.obj"></a-asset-item>
            <a-asset-item id="character_model" src="assets/models/character.obj"></a-asset-item>
            <a-asset-item id="bowl_model" src="assets/models/bowl.obj"></a-asset-item>
            <a-asset-item id="interactableIngredient_model" src="assets/models/ingredient.obj"></a-asset-item>
            <a-asset-item id="fryingPan_model" src="assets/models/fryingPan.obj"></a-asset-item>

            <a-asset-item id="speechBubble_model" src="assets/models/speechBubble.obj"></a-asset-item>

        </a-assets>

        <!---------------- NETWORK TEMPLATES ---------------->
        <a-assets>
            <template id="avatar_template"> 
                <a-entity class="avatar">
                <a-sphere class="head"
                          color="#5985ff"
                          scale="0.45 0.5 0.4"
                          random-color></a-sphere>
                </a-entity>
            </template>
        
            <template id="interactableIngredient_template">
                <a-entity class="interactableIngredient collidable" 
                            obj-model="obj:#interactableIngredient_model" 
                            material="color: #477725" 
                            object-pickup="position: 0.006 -0 -0.156; rotation: 0 0 0;" 
                            shadow=""
                            tool
                            detect-collision></a-entity>
            </template>

            <template id="knife_template">
                <a-entity class="knife collidable" 
                            obj-model="obj:#knife_model" 
                            material="color: #477725" 
                            shadow=""
                            tool
                            object-pickup="position: 0.755 -0.871 -0.357; rotation: 40 20 170"               
                            detect-collision></a-entity>
            </template>

            <template id="ladle_template">
                <a-entity class="ladle collidable" 
                            obj-model="obj:#ladle_model" 
                            material="color: #477725" 
                            shadow=""
                            tool
                            object-pickup="position: 0.826 -1.509 -0.711; rotation: -3 180 10" 
                            detect-collision></a-entity>
                </template>

            <template id="bowl_template">
                <a-entity class="bowl collidable" 
                            obj-model="obj:#bowl_model" 
                            material="color: #477725" 
                            shadow=""
                            tool
                            object-pickup="position: 0 -.5 0; rotation: 0 45 12" 
                            detect-collision
                            scale="0.1 0.1 0.1"></a-entity>
            </template>
         </a-assets>
        


        <!---------------- CAMERA ---------------->
        <a-entity id="cameraRig" position="0 1.9 3" rotation="0 0 0">
            <a-camera id="sceneCamera" networked="template:#avatar_template;attachTemplateToLocal:false;">
                <a-entity id="cursor" cursor="rayOrigin: mouse" position="0 0 -1"></a-entity>
                <a-sphere class="head" visible="false" random-color ></a-sphere>
            </a-camera>
        </a-entity>


        <!---------------- LIGHTING ---------------->
        <a-light type="directional" color="#FFBE92" position="35 17.746 -0.69474" intensity="0.5" scale="" light="castShadow:false;shadowCameraFov:60;shadowCameraLeft:-14.07;shadowCameraNear:0;shadowMapHeight:2048;shadowMapWidth:2048"></a-light>            
        <a-light type="ambient" color="white" position="35 5 0" intensity="0.4"></a-light>



       <!---------------- A-FRAME ENTITIES ---------------->

        <!-- SOUNDS ENTITIES -->
        <a-entity id="music" sound="src:#musicSrc; volume: 1; loop: true; positional:false" ></a-entity>
        <a-entity id="ambiance" sound="src:#ambianceSrc; volume: .4; loop: true; positional:false"></a-entity>

        
        <!-- CUSTOMER SERVICE -->
        <a-entity id="customerStation" 
            obj-model="obj:#customerService_model" 
            position="-0.00961 0 -0.85382" 
            rotation="" 
            scale="" 
            shadow="" 
            sound="src:#customerBellSrc"

            body="type: static; shape:none;"

            shape__main="shape: box;
            halfExtents: 2.95 1.9 1.1;
            offset: 0 0 0;">
        </a-entity>

        <a-entity new-recipe id="character1" obj-model="obj:#character_model" position="-0.00961 -0.01024 -2.69885" rotation="0 -82.328305582348 0" scale="" shadow="" sound="src: #customerGreetingSrc">
        </a-entity>
     
        <!-- speech bubble is loaded before the floor until it is displayed -->
        <a-entity id="speechBubble" obj-model="obj:#speechBubble_model" material="color:#ffffff" position="1.285 -2 -1.975" rotation="0 -30.385 0" scale="" shadow="">
        </a-entity>
        
        
        <!-- INGREDIENT STATION-->
         <a-entity id="ingredientStation" 
            obj-model="obj:#ingredientStation_model" 
            position="-3.828 0.1 11.265" 
            rotation="0 324 0" 
            scale="" 
            shadow=""

            static-body>
        </a-entity>

        <a-entity id='interactableIngredient_wrapper'>
        </a-entity>
        <a-entity id="interactableIngredient_placeholder" 
                class="interactableIngredient_placeholder collidable"
                object-place="hasCollision: true"   
                obj-model="obj:#interactableIngredient_model" 
                visible="false" 
                material="color: red; opacity: 0.2;" 
                position="5.562 3 4.863"  
                rotation="0 0 0" 
                scale="0.1 0.1 0.1" 
                shadow="cast:false"
                >
        </a-entity>

        <!-- this is the second red placement indicator for the stew  -->
        <a-entity object-place="hasCollision: true" id="interactableIngredient_placeholder2" class="interactableIngredient_placeholder" obj-model="obj:#interactableIngredient_model" visible="false" material="color: red; opacity: 0.2;" position="-0.883 3 5.748"  rotation="0 0 0" scale="0.1 0.1 0.1" shadow="cast:false">
        </a-entity>

        <!-- PREPERATION STATION-->
        <a-entity id="knife_wrapper"></a-entity>
        <a-entity id="knife_placeholder" class="knife_placeholder collidable" 
                    position="3.21 1.81 11.59" 
                    rotation="-3.2 -144 90" 
                    scale="0.1 0.1 0.1" 
                    obj-model="obj:#knife_model" 
                    material="color: red; opacity: 0.2;" 
                    object-place 
                    visible="false" 
                    shadow="">
        </a-entity>
        <a-entity id="prepStation" rotation="0 -232.21 0" position="3.27091 0 10.51185"> 
            <a-entity 
                id=prepStationTable 
                obj-model="obj:#table_model" 
                position="-1 -0.1 0" 
                rotation="0 90 0" 
                scale="" 
                shadow=""

                body="type: static; shape:none;"

                shape__main="shape: box;
                halfExtents: 2.95 1.9 1.1;
                offset: 0 0 0;">
            </a-entity>
            
            <!-- CUTTING BOARD AREA  position="-0.198 1.481 0.2"-->
            <a-entity id='cuttingBoard_area' rotation="0 90 0" position="-1.13659 0.39414 -0.46369"> 

                <a-entity id='cuttingBoard'obj-model="obj:#cuttingBoard_model" position="-0.55 1.414 0.3" rotation="" scale="0.7 0.7 0.7" shadow="">
                </a-entity>
                <a-entity 
                    obj-model="obj:#carrot_model" 
                    detect-collision 
                    position="-0.93936 1.39013 0.28187" 
                    rotation="0 -112.6 0" 
                    scale="0.3 0.3 0.3" 
                    shadow=""

                    body="type: dynamic; shape:none; linearDamping: 0.9; angularDamping: 0.9"
                    
                    shape__main="shape: box;
                    halfExtents: 0.2 0.2 1.5;
                    offset: 0 0.3 0.2;">  
                </a-entity>
        
                <!-- <a-entity id="knife_position_reader" >
                </a-entity>  -->
            </a-entity>       
        </a-entity>
      
      
        <!-- COOKING AREA -->
       <a-entity id="cookingStation" rotation="0 107.58 0" position="6.08818 0 4.25484"> 

            <a-entity obj-model="obj:#table_model" position="" rotation="" scale="" shadow="">
            </a-entity>

            <a-entity id="stove" obj-model="obj:#stove_model" position="0.04297 -0.34832 -0.16904" rotation="0 180 0" scale="0.8 0.8 0.8" shadow="">
            </a-entity>

            <a-entity 
                id="fryingPan" 
                obj-model="obj:#fryingPan_model" 
                position="-0.356 2.004 -0.561" 
                rotation="0 180 0" 
                scale="0.5 0.5 0.5" 
                shadow=""

                body="type: static; shape:none;"

                shape__main="shape: box;
                height: 0.1;
                halfExtents: 1 0.5 1;
                offset: 0 -0.5 0;">
            </a-entity>
          
        </a-entity>


        <!-- RECIPIE AREA -->
        <a-entity id="recipeStation" rotation="0 72 0" position="-6.58179 0 4.18675"> 

            <a-entity obj-model="obj:#table_model" position="" rotation="" scale="" shadow="">
            </a-entity>

            <a-entity obj-model="obj:#recipeBook_model" position="-0.07552 1.82164 0.12949" rotation="" scale="0.8 0.8 0.8" shadow="">
            </a-entity>

        </a-entity>


        <!-- STEW AREA -->
        <a-entity id="stewStation" rotation="0 -30 0" position="0 0 6">

            <a-entity obj-model="obj:#table_model" position="0.66201 0 -0.81071" rotation="0 -55.75395008638529 0" scale="0.41442 0.81438 0.5" shadow="">
            </a-entity>

            <a-entity 
                id="stewPot"
                obj-model="obj:#pot_model" 
                position="-0.77368 -0.1 0.25715" 
                rotation="0 90 0" 
                scale="0.8 0.8 0.8" 
                shadow=""

                body="type: static; shape:none;"

                shape__main="shape: cylinder;
                height: 4;
                radiusTop: 1.3;
                radiusBottom: 1.3;">
            </a-entity>
        </a-entity>
        <a-entity id="ladle_wrapper"></a-entity>
        <a-entity object-place id="ladle_placeholder" class="ladle_placeholder collidable" obj-model="obj:#ladle_model" visible="false" material="color: red; opacity: 0.2;" position="-0.99 1.5 5.229" rotation="-21 29 0" scale="0.1 0.1 0.1" shadow="">
        </a-entity>

        <a-entity id="bowl_wrapper"></a-entity>
        <a-entity object-place id="bowl_placeholder" class="bowl_placeholder collidable" obj-model="obj:#bowl_model" visible="false" material="color: red; opacity: 0.2;" position="1.1 1.5 4.88" rotation="" scale="0.1 0.1 0.1" shadow="">
        </a-entity>

       <!-- GROUND & SKY -->
       <a-plane static-body id="ground" position="0 0 5" width="30" height="30" rotation="-90 0 0" color="#a5a5a5" shadow></a-plane>
            
       <a-sky color="#ECECEC"></a-sky>
       <a-entity   id="sky"
                   geometry="primitive: sphere; radius: 1000"
                   material="shader: flat; src: #skymap; side: back"
                   loadscripts>
       </a-entity>

    </a-scene>

    
    <script>
      // Define custom schema for syncing avatar color, set by random-color
      NAF.schemas.add({
        template: '#avatar_template',
        components: [
          'position',
          'rotation',
          {
            selector: '.head',
            component: 'material',
            property: 'color'
          },
        ]
      });

      document.querySelector('a-scene').addEventListener('loaded', onSceneLoad)

     
    </script>
  </body>
</html>
